#!/bin/bash
# Push script for {{ service_name }}
# Generated by Service Template Generator

set -e

# Source configuration if it exists
if [ -f "config" ]; then
    source config
fi

# Default values
SERVICE_NAME="{{ service_name_kebab }}"
VERSION="{{ version }}"
REGISTRY="${REGISTRY:-{{ registry }}}"
NAMESPACE="${NAMESPACE:-{{ namespace }}}"

if [ -z "$REGISTRY" ]; then
    echo "Error: REGISTRY not set"
    exit 1
fi

# Push the images
FULL_IMAGE_NAME="$REGISTRY/$NAMESPACE/$SERVICE_NAME:$VERSION"
LATEST_IMAGE_NAME="$REGISTRY/$NAMESPACE/$SERVICE_NAME:latest"

echo "Pushing $FULL_IMAGE_NAME..."
docker push $FULL_IMAGE_NAME

echo "Pushing $LATEST_IMAGE_NAME..."
docker push $LATEST_IMAGE_NAME

echo "Push completed successfully!"
echo ""
echo "Images pushed:"
echo "  $FULL_IMAGE_NAME" 
echo "  $LATEST_IMAGE_NAME"
echo ""
echo "To deploy:"
echo "  helm install {{ service_name_kebab }} ./chart --set image.tag=$VERSION"